<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard ¬∑ RE/MAX Confluencia</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
  :root {
    --navy: #1a2d5a;
    --navy2: #223570;
    --navy3: #2a3f80;
    --red: #CC0000;
    --red2: #ff3333;
    --white: #ffffff;
    --gray: #8892a4;
    --lightgray: #c8d0e0;
    --gold: #f5c842;
    --green: #22c55e;
    --blue: #3b82f6;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Montserrat', sans-serif;
    background-color: var(--navy);
    background-image:
      radial-gradient(ellipse at 20% 0%, rgba(204,0,0,0.08) 0%, transparent 50%),
      radial-gradient(ellipse at 80% 100%, rgba(28,61,143,0.25) 0%, transparent 50%),
      url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.018'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    min-height: 100vh;
    color: var(--white);
  }

  /* ‚îÄ‚îÄ LOGIN SCREEN ‚îÄ‚îÄ */
  #loginScreen {
    position: fixed; inset: 0;
    background-color: var(--navy);
    background-image:
      radial-gradient(ellipse at 20% 0%, rgba(204,0,0,0.08) 0%, transparent 50%),
      radial-gradient(ellipse at 80% 100%, rgba(28,61,143,0.25) 0%, transparent 50%),
      url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.018'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    display: flex; align-items: center; justify-content: center;
    z-index: 999;
    transition: opacity 0.4s ease;
  }
  #loginScreen.hidden { opacity: 0; pointer-events: none; }

  .login-card {
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 20px;
    padding: 40px 36px;
    width: 100%; max-width: 360px;
    display: flex; flex-direction: column; align-items: center; gap: 24px;
    backdrop-filter: blur(10px);
    animation: fadeUp 0.5s ease forwards;
  }
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .login-bar {
    width: 3px; height: 40px;
    background: var(--red);
    border-radius: 2px;
  }
  .login-title { font-size: 13px; font-weight: 800; letter-spacing: 2px; text-transform: uppercase; text-align: center; }
  .login-sub { font-size: 11px; color: var(--gray); font-weight: 500; letter-spacing: 1px; text-align: center; margin-top: -16px; }
  .login-label {
    width: 100%;
    font-size: 11px; font-weight: 700; color: rgba(255,255,255,0.5);
    letter-spacing: 1px; text-transform: uppercase; margin-bottom: 6px;
  }
  .login-input-wrap { width: 100%; }
  .login-input {
    width: 100%;
    background: rgba(255,255,255,0.06);
    border: 1.5px solid rgba(255,255,255,0.1);
    border-radius: 10px;
    padding: 13px 16px;
    font-family: 'Montserrat', sans-serif;
    font-size: 15px; font-weight: 600;
    color: var(--white); outline: none;
    transition: border 0.2s;
    letter-spacing: 3px;
    text-align: center;
  }
  .login-input:focus { border-color: var(--red); }
  .login-input::placeholder { letter-spacing: 1px; font-size: 13px; color: rgba(255,255,255,0.25); }
  .login-error {
    font-size: 11px; color: #ff6666; font-weight: 600;
    letter-spacing: 0.5px; display: none; text-align: center;
  }
  .login-error.show { display: block; }
  .btn-login {
    width: 100%;
    padding: 14px;
    background: var(--red);
    border: none; border-radius: 10px;
    font-family: 'Montserrat', sans-serif;
    font-size: 12px; font-weight: 800;
    color: white; cursor: pointer;
    letter-spacing: 2px; text-transform: uppercase;
    transition: all 0.2s;
  }
  .btn-login:hover { background: #aa0000; transform: translateY(-1px); }
  .btn-login:active { transform: translateY(0); }
  .login-hint {
    font-size: 10px; color: rgba(255,255,255,0.2);
    font-weight: 500; letter-spacing: 0.5px; text-align: center;
  }

  /* ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ */
  #dashboardScreen { display: none; }
  #dashboardScreen.visible { display: block; animation: fadeUp 0.4s ease forwards; }

  /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
  .header {
    background: rgba(26,45,90,0.95);
    border-bottom: 1px solid rgba(255,255,255,0.07);
    padding: 16px 28px;
    display: flex; align-items: center; justify-content: space-between;
    position: sticky; top: 0; z-index: 100;
    backdrop-filter: blur(8px);
  }
  .header-left { display: flex; align-items: center; gap: 14px; }
  .header-logo { width: 3px; height: 34px; background: var(--red); border-radius: 2px; }
  .header-title { font-size: 12px; font-weight: 800; letter-spacing: 2px; text-transform: uppercase; }
  .header-sub { font-size: 10px; color: var(--gray); font-weight: 500; letter-spacing: 1px; margin-top: 2px; }
  .header-right { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
  .live-badge {
    display: flex; align-items: center; gap: 6px;
    background: rgba(34,197,94,0.12);
    border: 1px solid rgba(34,197,94,0.3);
    border-radius: 50px; padding: 5px 12px;
    font-size: 10px; font-weight: 700; color: var(--green);
    letter-spacing: 1px; text-transform: uppercase;
  }
  .live-dot { width: 6px; height: 6px; background: var(--green); border-radius: 50%; animation: pulse 2s infinite; }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }
  .btn-refresh {
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 8px; padding: 7px 14px;
    font-family: 'Montserrat', sans-serif;
    font-size: 11px; font-weight: 700;
    color: var(--white); cursor: pointer;
    letter-spacing: 1px; text-transform: uppercase;
    transition: all 0.2s;
  }
  .btn-refresh:hover { border-color: var(--red); }
  .btn-logout {
    background: transparent;
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 8px; padding: 7px 14px;
    font-family: 'Montserrat', sans-serif;
    font-size: 11px; font-weight: 700;
    color: var(--gray); cursor: pointer;
    letter-spacing: 1px; text-transform: uppercase;
    transition: all 0.2s;
  }
  .btn-logout:hover { border-color: rgba(255,255,255,0.3); color: white; }
  .last-update { font-size: 10px; color: var(--gray); font-weight: 500; }

  /* ‚îÄ‚îÄ FILTERS ‚îÄ‚îÄ */
  .filters {
    padding: 14px 28px;
    display: flex; gap: 8px; flex-wrap: wrap; align-items: center;
    border-bottom: 1px solid rgba(255,255,255,0.05);
  }
  .filter-label { font-size: 10px; font-weight: 700; color: var(--gray); letter-spacing: 1px; text-transform: uppercase; margin-right: 4px; }
  .filter-btn {
    padding: 6px 14px; border-radius: 50px;
    border: 1px solid rgba(255,255,255,0.1);
    background: transparent;
    font-family: 'Montserrat', sans-serif;
    font-size: 11px; font-weight: 600;
    color: var(--gray); cursor: pointer; transition: all 0.2s;
  }
  .filter-btn.active, .filter-btn:hover { background: var(--red); border-color: var(--red); color: white; }

  /* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
  .main { padding: 22px 28px; display: flex; flex-direction: column; gap: 20px; }

  /* ‚îÄ‚îÄ KPI GRID ‚îÄ‚îÄ */
  .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(170px, 1fr)); gap: 14px; }
  .kpi-card {
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 14px; padding: 18px;
    position: relative; overflow: hidden;
    animation: fadeUp 0.5s ease forwards; opacity: 0;
  }
  .kpi-card:nth-child(1){animation-delay:0.05s}
  .kpi-card:nth-child(2){animation-delay:0.1s}
  .kpi-card:nth-child(3){animation-delay:0.15s}
  .kpi-card:nth-child(4){animation-delay:0.2s}
  .kpi-card::after {
    content:''; position:absolute; top:0; left:0; right:0;
    height:3px; background:var(--red); border-radius:14px 14px 0 0;
  }
  .kpi-card.green::after{background:var(--green)}
  .kpi-card.blue::after{background:var(--blue)}
  .kpi-card.gold::after{background:var(--gold)}
  .kpi-icon { font-size: 20px; margin-bottom: 10px; }
  .kpi-value { font-size: 30px; font-weight: 900; letter-spacing: -1px; line-height: 1; }
  .kpi-label { font-size: 10px; font-weight: 700; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px; margin-top: 6px; }
  .kpi-sub { font-size: 11px; color: var(--gray); margin-top: 4px; }

  /* ‚îÄ‚îÄ SECTION ‚îÄ‚îÄ */
  .section-title {
    font-size: 10px; font-weight: 800; letter-spacing: 2px;
    text-transform: uppercase; color: var(--gray);
    display: flex; align-items: center; gap: 10px; margin-bottom: 12px;
  }
  .section-title::after { content:''; flex:1; height:1px; background:rgba(255,255,255,0.06); }

  /* ‚îÄ‚îÄ PANEL ‚îÄ‚îÄ */
  .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  @media(max-width:700px){.two-col{grid-template-columns:1fr}}
  .panel {
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 14px; padding: 20px;
    animation: fadeUp 0.5s ease forwards; opacity: 0;
  }
  .panel:nth-child(1){animation-delay:0.25s}
  .panel:nth-child(2){animation-delay:0.3s}
  .panel-title {
    font-size: 11px; font-weight: 800; letter-spacing: 1.5px;
    text-transform: uppercase; margin-bottom: 16px;
    display: flex; align-items: center; gap: 8px;
  }
  .dot { width: 7px; height: 7px; border-radius: 50%; background: var(--red); }
  .dot.green{background:var(--green)} .dot.blue{background:var(--blue)} .dot.gold{background:var(--gold)}

  /* ‚îÄ‚îÄ RANKING ‚îÄ‚îÄ */
  .agent-row {
    display: flex; align-items: center; gap: 10px;
    padding: 9px 0; border-bottom: 1px solid rgba(255,255,255,0.04);
  }
  .agent-row:last-child{border-bottom:none}
  .agent-rank {
    width: 22px; height: 22px; border-radius: 50%;
    background: rgba(255,255,255,0.07);
    display: flex; align-items: center; justify-content: center;
    font-size: 10px; font-weight: 800; flex-shrink: 0;
  }
  .agent-rank.gold{background:rgba(245,200,66,0.2);color:var(--gold)}
  .agent-rank.silver{background:rgba(200,208,224,0.2);color:var(--lightgray)}
  .agent-rank.bronze{background:rgba(180,120,60,0.2);color:#cd7f32}
  .agent-info { flex: 1; min-width: 0; }
  .agent-name { font-size: 13px; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .agent-count { font-size: 10px; color: var(--gray); font-weight: 500; margin-top: 1px; }
  .bar-wrap { flex: 1; max-width: 80px; }
  .bar-bg { height: 4px; background: rgba(255,255,255,0.07); border-radius: 4px; }
  .bar-fill { height: 4px; border-radius: 4px; background: var(--gold); transition: width 0.8s ease; }
  .agent-stars { display: flex; align-items: center; gap: 3px; }
  .stars-val { font-size: 13px; font-weight: 900; }
  .star-icon { color: var(--gold); font-size: 12px; }

  /* ‚îÄ‚îÄ WAIT BARS ‚îÄ‚îÄ */
  .wait-bars { display: flex; flex-direction: column; gap: 10px; }
  .wait-row { display: flex; align-items: center; gap: 10px; }
  .wait-label { font-size: 11px; font-weight: 600; color: var(--lightgray); width: 75px; flex-shrink: 0; }
  .wait-bar-bg { flex: 1; height: 20px; background: rgba(255,255,255,0.05); border-radius: 4px; overflow: hidden; }
  .wait-bar-fill { height: 100%; border-radius: 4px; display: flex; align-items: center; padding-left: 8px; font-size: 10px; font-weight: 700; transition: width 0.8s ease; white-space: nowrap; }
  .wait-pct { font-size: 11px; font-weight: 700; color: var(--gray); width: 32px; text-align: right; flex-shrink: 0; }

  /* ‚îÄ‚îÄ IMPROVE TAGS ‚îÄ‚îÄ */
  .improve-grid { display: flex; flex-wrap: wrap; gap: 8px; }
  .improve-tag {
    padding: 8px 14px; border-radius: 8px;
    font-size: 12px; font-weight: 700;
    display: flex; align-items: center; gap: 8px;
    transition: transform 0.2s; cursor: default;
  }
  .improve-tag:hover{transform:translateY(-2px)}
  .tag-count { font-size: 15px; font-weight: 900; }
  .tag-label { font-size: 11px; font-weight: 600; opacity: 0.85; }

  /* ‚îÄ‚îÄ DONUT ‚îÄ‚îÄ */
  .resolution-wrap { display: flex; align-items: center; gap: 18px; }
  .donut-wrap { position: relative; width: 110px; height: 110px; flex-shrink: 0; }
  .donut-center { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; }
  .donut-pct { font-size: 20px; font-weight: 900; }
  .donut-sub { font-size: 9px; font-weight: 600; color: var(--gray); letter-spacing: 1px; text-transform: uppercase; }
  .resolution-legend { display: flex; flex-direction: column; gap: 7px; }
  .leg-row { display: flex; align-items: center; gap: 7px; }
  .leg-dot { width: 7px; height: 7px; border-radius: 50%; flex-shrink: 0; }
  .leg-label { font-size: 11px; color: var(--lightgray); font-weight: 500; }
  .leg-val { font-size: 11px; font-weight: 700; margin-left: auto; padding-left: 12px; }

  /* ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ */
  .recent-table { width: 100%; border-collapse: collapse; }
  .recent-table th {
    font-size: 9px; font-weight: 700; letter-spacing: 1.5px; text-transform: uppercase;
    color: var(--gray); padding: 0 8px 10px; text-align: left;
    border-bottom: 1px solid rgba(255,255,255,0.07);
  }
  .recent-table td {
    padding: 9px 8px; font-size: 12px; font-weight: 500;
    border-bottom: 1px solid rgba(255,255,255,0.04); vertical-align: middle;
  }
  .recent-table tr:last-child td{border-bottom:none}
  .td-stars{color:var(--gold);font-size:11px;letter-spacing:1px}
  .td-chip{display:inline-block;padding:3px 8px;border-radius:4px;font-size:10px;font-weight:700;letter-spacing:0.5px;text-transform:uppercase}
  .chip-green{background:rgba(34,197,94,0.15);color:var(--green)}
  .chip-yellow{background:rgba(245,200,66,0.15);color:var(--gold)}
  .chip-red{background:rgba(204,0,0,0.15);color:var(--red2)}
  .td-gray{color:var(--gray);font-size:11px}

  /* ‚îÄ‚îÄ DEMO NOTICE ‚îÄ‚îÄ */
  .demo-notice {
    background: rgba(245,200,66,0.08);
    border: 1px solid rgba(245,200,66,0.2);
    border-radius: 10px; padding: 12px 16px;
    font-size: 11px; color: rgba(245,200,66,0.8);
    font-weight: 500; margin-bottom: 4px;
    display: flex; align-items: center; gap: 8px;
  }

  .spinner { width: 28px; height: 28px; border: 3px solid rgba(255,255,255,0.1); border-top-color: var(--red); border-radius: 50%; animation: spin 0.8s linear infinite; }
  @keyframes spin{to{transform:rotate(360deg)}}
  .loading { display: flex; align-items: center; justify-content: center; min-height: 120px; gap: 10px; flex-direction: column; }
  .loading-text { font-size: 10px; font-weight: 600; color: var(--gray); letter-spacing: 1px; text-transform: uppercase; }

  /* ‚îÄ‚îÄ AGENT SELECT ‚îÄ‚îÄ */
  .agent-select-wrap { margin-bottom: 18px; position: relative; }
  .agent-select {
    width: 100%;
    background: rgba(255,255,255,0.06);
    border: 1.5px solid rgba(255,255,255,0.12);
    border-radius: 10px;
    padding: 12px 16px;
    font-family: 'Montserrat', sans-serif;
    font-size: 13px; font-weight: 600;
    color: var(--white); outline: none; cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%238892a4' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 14px center;
    padding-right: 36px;
    transition: border 0.2s;
  }
  .agent-select:focus { border-color: var(--red); }
  .agent-select option { background: #1a2d5a; color: white; font-weight: 600; }

  .agent-detail-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px,1fr)); gap: 12px; margin-bottom: 18px; }
  .agent-stat {
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.07);
    border-radius: 10px; padding: 14px;
    text-align: center;
  }
  .agent-stat-val { font-size: 24px; font-weight: 900; }
  .agent-stat-label { font-size: 10px; font-weight: 600; color: var(--gray); text-transform: uppercase; letter-spacing: 1px; margin-top: 4px; }

  .comment-list { display: flex; flex-direction: column; gap: 8px; margin-top: 14px; }
  .comment-item {
    background: rgba(255,255,255,0.03);
    border-left: 3px solid var(--red);
    border-radius: 0 8px 8px 0;
    padding: 10px 14px;
    font-size: 12px; color: var(--lightgray);
    font-weight: 500; line-height: 1.4;
  }
  .comment-meta { font-size: 10px; color: var(--gray); margin-top: 4px; }

  .star-row { display: flex; gap: 6px; margin-bottom: 10px; }
  .star-count-row { display: flex; align-items: center; gap: 8px; }
  .star-count-label { font-size: 12px; color: var(--gold); width: 60px; flex-shrink: 0; letter-spacing: 1px; }
  .star-count-bar-bg { flex: 1; height: 8px; background: rgba(255,255,255,0.07); border-radius: 4px; overflow: hidden; }
  .star-count-bar-fill { height: 100%; background: var(--gold); border-radius: 4px; transition: width 0.7s ease; }
  .star-count-n { font-size: 11px; font-weight: 700; color: var(--gray); width: 20px; text-align: right; flex-shrink: 0; }

  @media(max-width:600px){
    .header{padding:12px 16px}
    .main{padding:14px 16px}
    .filters{padding:10px 16px}
    .kpi-grid{grid-template-columns:1fr 1fr}
    .header-right .last-update{display:none}
  }
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginScreen">
  <div class="login-card">
    <div class="login-bar"></div>
    <div>
      <div class="login-title">RE/MAX Confluencia</div>
      <div class="login-sub" style="margin-top:6px">Dashboard de m√©tricas</div>
    </div>
    <div class="login-input-wrap">
      <div class="login-label">üîí Contrase√±a</div>
      <input class="login-input" type="password" id="passInput" placeholder="Ingres√° la clave" onkeydown="if(event.key==='Enter') checkPass()">
    </div>
    <div class="login-error" id="loginError">Contrase√±a incorrecta</div>
    <button class="btn-login" onclick="checkPass()">Ingresar</button>
    <div class="login-hint">Solo equipo RE/MAX Confluencia</div>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashboardScreen">

  <div class="header">
    <div class="header-left">
      <div class="header-logo"></div>
      <div>
        <div class="header-title">RE/MAX Confluencia</div>
        <div class="header-sub">Dashboard de Atenci√≥n ¬∑ Guardias</div>
      </div>
    </div>
    <div class="header-right">
      <div class="live-badge"><div class="live-dot"></div>En vivo</div>
      <span class="last-update" id="lastUpdate">‚Äî</span>
      <button class="btn-refresh" onclick="loadData()">‚Üª Actualizar</button>
      <button class="btn-logout" onclick="logout()">Salir</button>
    </div>
  </div>

  <div class="filters">
    <span class="filter-label">Per√≠odo:</span>
    <button class="filter-btn active" onclick="setFilter('week',this)">Esta semana</button>
    <button class="filter-btn" onclick="setFilter('month',this)">Este mes</button>
    <button class="filter-btn" onclick="setFilter('all',this)">Todo</button>
  </div>

  <div class="main">
    <div id="demoNotice"></div>

    <div>
      <div class="section-title">Resumen general</div>
      <div class="kpi-grid" id="kpiGrid"><div class="loading"><div class="spinner"></div><div class="loading-text">Cargando...</div></div></div>
    </div>

    <div class="two-col">
      <div class="panel">
        <div class="panel-title"><div class="dot gold"></div>Ranking de agentes</div>
        <div id="rankingPanel"><div class="loading"><div class="spinner"></div></div></div>
      </div>
      <div class="panel">
        <div class="panel-title"><div class="dot blue"></div>Tiempo de espera</div>
        <div id="waitPanel"><div class="loading"><div class="spinner"></div></div></div>
      </div>
    </div>

    <div class="two-col">
      <div class="panel">
        <div class="panel-title"><div class="dot"></div>¬øQu√© mejorar?</div>
        <div id="improvePanel"><div class="loading"><div class="spinner"></div></div></div>
      </div>
      <div class="panel">
        <div class="panel-title"><div class="dot green"></div>Resoluci√≥n de consultas</div>
        <div id="resolutionPanel"><div class="loading"><div class="spinner"></div></div></div>
      </div>
    </div>

    <div class="panel" style="animation-delay:0.35s">
      <div class="panel-title"><div class="dot"></div>√öltimas encuestas</div>
      <div id="recentPanel"><div class="loading"><div class="spinner"></div></div></div>
    </div>

    <div class="panel" style="animation-delay:0.4s">
      <div class="panel-title"><div class="dot gold"></div>Detalle por agente</div>
      <div class="agent-select-wrap">
        <select class="agent-select" id="agentSelect" onchange="selectAgent(this.value)"></select>
      </div>
      <div id="agentDetail"><div class="loading"><div class="spinner"></div></div></div>
    </div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONFIGURACI√ìN ‚Äî cambi√° estos dos valores
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const PASSWORD = '2580';  // ‚Üê cambi√° por la clave que quieras
const SHEET_URL = 'https://script.google.com/macros/s/AKfycbyXu26U4Iwnas6KuOsDZnAJ0lZoifXWXW-rlFVjv3z4kLco_RMWY_Ml8hb3UCJIut1DFg/exec';
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const SESSION_KEY = 'rmx_dash_auth';

// ‚îÄ‚îÄ LOGIN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function checkPass() {
  const val = document.getElementById('passInput').value;
  const err = document.getElementById('loginError');
  if (val === PASSWORD) {
    sessionStorage.setItem(SESSION_KEY, '1');
    document.getElementById('loginScreen').classList.add('hidden');
    setTimeout(() => {
      document.getElementById('loginScreen').style.display = 'none';
      document.getElementById('dashboardScreen').classList.add('visible');
      loadData();
    }, 400);
    err.classList.remove('show');
  } else {
    err.classList.add('show');
    document.getElementById('passInput').value = '';
    document.getElementById('passInput').focus();
    document.getElementById('passInput').style.borderColor = 'var(--red2)';
    setTimeout(() => document.getElementById('passInput').style.borderColor = '', 1000);
  }
}

function logout() {
  sessionStorage.removeItem(SESSION_KEY);
  document.getElementById('dashboardScreen').classList.remove('visible');
  document.getElementById('loginScreen').style.display = 'flex';
  setTimeout(() => document.getElementById('loginScreen').classList.remove('hidden'), 10);
  document.getElementById('passInput').value = '';
}

// Auto-login si ya estaba autenticado en esta sesi√≥n
if (sessionStorage.getItem(SESSION_KEY)) {
  document.getElementById('loginScreen').style.display = 'none';
  document.getElementById('dashboardScreen').classList.add('visible');
}

// ‚îÄ‚îÄ DATOS DEMO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const DEMO = [
  {fecha:'2026-02-24',agente:'Mar√≠a Gonz√°lez',cliente:'Carlos L√≥pez',telefono:'299 412 3456',estrellas:5,espera:'Sin espera',resolucion:'S√≠',mejoras:'Nada, estuvo bien',comentario:'Excelente atenci√≥n'},
  {fecha:'2026-02-24',agente:'Juan P√©rez',cliente:'Ana Mart√≠nez',telefono:'',estrellas:4,espera:'1‚Äì5 min',resolucion:'Bastante',mejoras:'Rapidez',comentario:''},
  {fecha:'2026-02-23',agente:'Mar√≠a Gonz√°lez',cliente:'Roberto Silva',telefono:'299 443 8821',estrellas:5,espera:'Sin espera',resolucion:'S√≠',mejoras:'Nada, estuvo bien',comentario:'Muy profesional'},
  {fecha:'2026-02-23',agente:'Laura D√≠az',cliente:'Patricia Ruiz',telefono:'',estrellas:3,espera:'5‚Äì10 min',resolucion:'M√°s o menos',mejoras:'Rapidez,Amabilidad',comentario:'Tardaron mucho'},
  {fecha:'2026-02-22',agente:'Juan P√©rez',cliente:'Miguel Torres',telefono:'299 456 7890',estrellas:5,espera:'1‚Äì5 min',resolucion:'S√≠',mejoras:'Nada, estuvo bien',comentario:''},
  {fecha:'2026-02-22',agente:'Carlos Vega',cliente:'Sof√≠a Herrera',telefono:'',estrellas:4,espera:'Sin espera',resolucion:'Bastante',mejoras:'Info. brindada',comentario:'Buena atenci√≥n'},
  {fecha:'2026-02-21',agente:'Laura D√≠az',cliente:'Diego Fern√°ndez',telefono:'299 401 5544',estrellas:5,espera:'Sin espera',resolucion:'S√≠',mejoras:'Nada, estuvo bien',comentario:''},
  {fecha:'2026-02-21',agente:'Mar√≠a Gonz√°lez',cliente:'Elena Castro',telefono:'',estrellas:4,espera:'1‚Äì5 min',resolucion:'Bastante',mejoras:'Seguimiento',comentario:''},
  {fecha:'2026-02-20',agente:'Carlos Vega',cliente:'Luc√≠a Morales',telefono:'299 488 2211',estrellas:2,espera:'+10 min',resolucion:'No',mejoras:'Rapidez,Amabilidad,Info. brindada',comentario:'Espera muy larga'},
  {fecha:'2026-02-20',agente:'Juan P√©rez',cliente:'Fernando Blanco',telefono:'',estrellas:5,espera:'Sin espera',resolucion:'S√≠',mejoras:'Nada, estuvo bien',comentario:'Perfecto'},
];

let allData = [], currentFilter = 'week', usingDemo = false;

function setFilter(f, btn) {
  currentFilter = f;
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderAll(filterData(allData));
}

function filterData(data) {
  const now = new Date();
  return data.filter(r => {
    if (currentFilter === 'all') return true;
    const d = new Date(r.fecha);
    if (currentFilter === 'week') { const w = new Date(now); w.setDate(now.getDate()-7); return d >= w; }
    if (currentFilter === 'month') return d.getMonth()===now.getMonth() && d.getFullYear()===now.getFullYear();
    return true;
  });
}

async function loadData() {
  try {
    if (SHEET_URL !== 'TU_APPS_SCRIPT_URL_AQUI') {
      const res = await fetch(SHEET_URL);
      allData = await res.json();
      usingDemo = false;
    } else throw new Error('demo');
  } catch {
    allData = DEMO;
    usingDemo = true;
  }
  document.getElementById('lastUpdate').textContent = 'Actualizado ' + new Date().toLocaleTimeString('es-AR',{hour:'2-digit',minute:'2-digit'});
  renderAll(filterData(allData));
}

function renderAll(data) {
  renderKPIs(data);
  renderRanking(data);
  renderWait(data);
  renderImprove(data);
  renderResolution(data);
  renderRecent(data);
  renderAgentTabs(data);
  document.getElementById('demoNotice').innerHTML = usingDemo
    ? '<div class="demo-notice">‚ö†Ô∏è Mostrando datos de ejemplo ‚Äî configur√° el Apps Script para ver datos reales</div>' : '';
}

// ‚îÄ‚îÄ AGENT DETAIL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let selectedAgent = null;

function renderAgentTabs(data) {
  if (!data.length) {
    document.getElementById('agentSelect').innerHTML = '<option>Sin datos</option>';
    document.getElementById('agentDetail').innerHTML = empty();
    return;
  }
  const agents = [...new Set(data.map(r => r.agente))].sort();
  if (!selectedAgent || !agents.includes(selectedAgent)) selectedAgent = agents[0];

  document.getElementById('agentSelect').innerHTML = agents.map(a =>
    `<option value="${a}" ${a === selectedAgent ? 'selected' : ''}>${a}</option>`
  ).join('');

  renderAgentDetail(data, selectedAgent);
}

function selectAgent(name) {
  selectedAgent = name;
  renderAgentDetail(filterData(allData), name);
}

function renderAgentDetail(data, agentName) {
  const rows = data.filter(r => r.agente === agentName);
  if (!rows.length) {
    document.getElementById('agentDetail').innerHTML = `<div style="text-align:center;padding:20px;color:var(--gray);font-size:12px">Sin encuestas para este per√≠odo</div>`;
    return;
  }

  const total = rows.length;
  const avg = (rows.reduce((a,r) => a+Number(r.estrellas), 0) / total).toFixed(1);
  const sinEspera = rows.filter(r => r.espera === 'Sin espera').length;
  const positivos = rows.filter(r => ['S√≠','Bastante'].includes(r.resolucion)).length;
  const posPct = Math.round(positivos / total * 100);

  // Distribuci√≥n de estrellas
  const starDist = [5,4,3,2,1].map(n => ({ n, count: rows.filter(r => Number(r.estrellas) === n).length }));

  // Comentarios no vac√≠os
  const comments = rows.filter(r => r.comentario && r.comentario.trim()).slice(-5).reverse();

  // Mejoras m√°s pedidas
  const mejCounts = {};
  rows.forEach(r => { if(!r.mejoras) return; r.mejoras.split(',').forEach(m => { const k=m.trim(); if(k && !k.includes('Nada')) mejCounts[k]=(mejCounts[k]||0)+1; }); });
  const topMejoras = Object.entries(mejCounts).sort((a,b)=>b[1]-a[1]).slice(0,3);

  document.getElementById('agentDetail').innerHTML = `
    <div class="agent-detail-grid">
      <div class="agent-stat">
        <div class="agent-stat-val">${total}</div>
        <div class="agent-stat-label">Encuestas</div>
      </div>
      <div class="agent-stat">
        <div class="agent-stat-val" style="color:var(--gold)">${avg}‚òÖ</div>
        <div class="agent-stat-label">Promedio</div>
      </div>
      <div class="agent-stat">
        <div class="agent-stat-val" style="color:var(--green)">${posPct}%</div>
        <div class="agent-stat-label">Resoluci√≥n positiva</div>
      </div>
      <div class="agent-stat">
        <div class="agent-stat-val" style="color:var(--blue)">${Math.round(sinEspera/total*100)}%</div>
        <div class="agent-stat-label">Sin espera</div>
      </div>
    </div>

    <div class="two-col" style="margin-bottom:16px">
      <div>
        <div style="font-size:10px;font-weight:700;color:var(--gray);letter-spacing:1px;text-transform:uppercase;margin-bottom:10px">Distribuci√≥n de estrellas</div>
        <div style="display:flex;flex-direction:column;gap:7px">
          ${starDist.map(s => `
            <div class="star-count-row">
              <div class="star-count-label">${'‚òÖ'.repeat(s.n)}</div>
              <div class="star-count-bar-bg"><div class="star-count-bar-fill" style="width:${total?s.count/total*100:0}%"></div></div>
              <div class="star-count-n">${s.count}</div>
            </div>`).join('')}
        </div>
      </div>
      <div>
        <div style="font-size:10px;font-weight:700;color:var(--gray);letter-spacing:1px;text-transform:uppercase;margin-bottom:10px">Aspectos a mejorar</div>
        ${topMejoras.length
          ? `<div style="display:flex;flex-direction:column;gap:8px">${topMejoras.map(([l,n]) => `
              <div style="display:flex;align-items:center;gap:8px">
                <div style="background:rgba(204,0,0,0.15);color:#ff6666;border-radius:6px;padding:4px 10px;font-size:11px;font-weight:700">${n}x</div>
                <div style="font-size:12px;color:var(--lightgray);font-weight:500">${l}</div>
              </div>`).join('')}</div>`
          : `<div style="font-size:12px;color:var(--green);font-weight:600">üéâ Sin puntos cr√≠ticos</div>`
        }
      </div>
    </div>

    ${comments.length ? `
      <div style="font-size:10px;font-weight:700;color:var(--gray);letter-spacing:1px;text-transform:uppercase;margin-bottom:10px">√öltimos comentarios</div>
      <div class="comment-list">
        ${comments.map(r => `
          <div class="comment-item">
            "${r.comentario}"
            <div class="comment-meta">${fmtDate(r.fecha)} ¬∑ ${r.cliente ? r.cliente.split(' ')[0] : 'Cliente'} ¬∑ ${'‚òÖ'.repeat(Number(r.estrellas))}</div>
          </div>`).join('')}
      </div>` : ''}
  `;
}

// ‚îÄ‚îÄ KPIs ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderKPIs(data) {
  if (!data.length) { document.getElementById('kpiGrid').innerHTML = empty(); return; }
  const total = data.length;
  const avg = (data.reduce((a,r)=>a+Number(r.estrellas),0)/total).toFixed(1);
  const top = getTop(data);
  const sinEspera = data.filter(r=>r.espera==='Sin espera').length;
  document.getElementById('kpiGrid').innerHTML = `
    <div class="kpi-card"><div class="kpi-icon">üìã</div><div class="kpi-value">${total}</div><div class="kpi-label">Encuestas totales</div><div class="kpi-sub">En el per√≠odo</div></div>
    <div class="kpi-card gold"><div class="kpi-icon">‚≠ê</div><div class="kpi-value" style="color:var(--gold)">${avg}</div><div class="kpi-label">Calificaci√≥n promedio</div><div class="kpi-sub">Sobre 5 estrellas</div></div>
    <div class="kpi-card green"><div class="kpi-icon">üèÜ</div><div class="kpi-value" style="font-size:18px;padding-top:6px">${top.name}</div><div class="kpi-label">Mejor agente</div><div class="kpi-sub">${top.avg}‚òÖ ¬∑ ${top.count} encuestas</div></div>
    <div class="kpi-card blue"><div class="kpi-icon">‚ö°</div><div class="kpi-value" style="color:var(--blue)">${Math.round(sinEspera/total*100)}%</div><div class="kpi-label">Sin tiempo de espera</div><div class="kpi-sub">${sinEspera} de ${total}</div></div>
  `;
}

function getTop(data) {
  const a = {};
  data.forEach(r=>{ if(!a[r.agente]) a[r.agente]={sum:0,count:0}; a[r.agente].sum+=Number(r.estrellas); a[r.agente].count++; });
  let best={name:'‚Äî',avg:0,count:0};
  for(const [name,v] of Object.entries(a)){ const avg=v.sum/v.count; if(avg>best.avg||(avg===best.avg&&v.count>best.count)) best={name:name.split(' ')[0],avg:avg.toFixed(1),count:v.count}; }
  return best;
}

// ‚îÄ‚îÄ RANKING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderRanking(data) {
  if (!data.length) { document.getElementById('rankingPanel').innerHTML = empty(); return; }
  const a = {};
  data.forEach(r=>{ if(!a[r.agente]) a[r.agente]={sum:0,count:0}; a[r.agente].sum+=Number(r.estrellas); a[r.agente].count++; });
  const sorted = Object.entries(a).map(([name,v])=>({name,avg:v.sum/v.count,count:v.count})).sort((a,b)=>b.avg-a.avg||b.count-a.count);
  const rc=['gold','silver','bronze'], re=['ü•á','ü•à','ü•â'];
  document.getElementById('rankingPanel').innerHTML = sorted.map((ag,i)=>`
    <div class="agent-row">
      <div class="agent-rank ${rc[i]||''}">${i<3?re[i]:i+1}</div>
      <div class="agent-info"><div class="agent-name">${ag.name}</div><div class="agent-count">${ag.count} encuesta${ag.count!==1?'s':''}</div></div>
      <div class="bar-wrap"><div class="bar-bg"><div class="bar-fill" style="width:${ag.avg/5*100}%"></div></div></div>
      <div class="agent-stars"><span class="stars-val">${ag.avg.toFixed(1)}</span><span class="star-icon">‚òÖ</span></div>
    </div>`).join('');
}

// ‚îÄ‚îÄ WAIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderWait(data) {
  if (!data.length) { document.getElementById('waitPanel').innerHTML = empty(); return; }
  const cats=['Sin espera','1‚Äì5 min','5‚Äì10 min','+10 min'];
  const cols=['#22c55e','#3b82f6','#f5c842','#CC0000'];
  const total = data.length;
  document.getElementById('waitPanel').innerHTML = `<div class="wait-bars">${cats.map((c,i)=>{
    const n=data.filter(r=>r.espera===c).length, pct=Math.round(n/total*100);
    return `<div class="wait-row"><div class="wait-label">${c}</div><div class="wait-bar-bg"><div class="wait-bar-fill" style="width:${pct}%;background:${cols[i]};color:${pct>18?'white':'transparent'}">${n} resp.</div></div><div class="wait-pct">${pct}%</div></div>`;
  }).join('')}</div>`;
}

// ‚îÄ‚îÄ IMPROVE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderImprove(data) {
  if (!data.length) { document.getElementById('improvePanel').innerHTML = empty(); return; }
  const counts = {};
  data.forEach(r=>{ if(!r.mejoras) return; r.mejoras.split(',').forEach(m=>{ const k=m.trim(); if(k&&!k.includes('Nada')) counts[k]=(counts[k]||0)+1; }); });
  const ninguno = data.filter(r=>r.mejoras&&r.mejoras.includes('Nada')).length;
  const sorted = Object.entries(counts).sort((a,b)=>b[1]-a[1]);
  const tc=[{bg:'rgba(204,0,0,0.15)',c:'#ff6666'},{bg:'rgba(59,130,246,0.15)',c:'#60a5fa'},{bg:'rgba(245,200,66,0.15)',c:'#fde047'},{bg:'rgba(168,85,247,0.15)',c:'#c084fc'},{bg:'rgba(34,197,94,0.15)',c:'#4ade80'}];
  if (!sorted.length) {
    document.getElementById('improvePanel').innerHTML = `<div style="text-align:center;padding:16px"><div style="font-size:28px;margin-bottom:6px">üéâ</div><div style="font-size:12px;font-weight:700;color:var(--green)">¬°Sin puntos cr√≠ticos!</div><div style="font-size:11px;color:var(--gray);margin-top:4px">${ninguno} clientes dijeron que estuvo bien</div></div>`;
    return;
  }
  document.getElementById('improvePanel').innerHTML = `<div class="improve-grid">${sorted.map(([l,n],i)=>{const c=tc[i%tc.length];return `<div class="improve-tag" style="background:${c.bg};color:${c.c}"><span class="tag-count">${n}</span><span class="tag-label">${l}</span></div>`;}).join('')}</div>${ninguno?`<div style="margin-top:12px;font-size:11px;color:var(--gray)">+ <strong style="color:var(--green)">${ninguno}</strong> clientes dijeron que estuvo bien</div>`:''}`;
}

// ‚îÄ‚îÄ RESOLUTION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderResolution(data) {
  if (!data.length) { document.getElementById('resolutionPanel').innerHTML = empty(); return; }
  const cats=['S√≠','Bastante','M√°s o menos','No mucho','No'];
  const cols=['#22c55e','#86efac','#f5c842','#f97316','#CC0000'];
  const total = data.length;
  const counts = cats.map(c=>data.filter(r=>r.resolucion===c).length);
  const posPct = total ? Math.round((counts[0]+counts[1])/total*100) : 0;
  const R=48,cx=55,cy=55,circ=2*Math.PI*R;
  let off=0;
  const segs=counts.map((c,i)=>{const d=c/total*circ;const s={col:cols[i],dash:d,gap:circ-d,off};off+=d;return s;}).filter(s=>s.dash>0);
  document.getElementById('resolutionPanel').innerHTML = `
    <div class="resolution-wrap">
      <div class="donut-wrap">
        <svg width="110" height="110" viewBox="0 0 110 110">
          <circle cx="${cx}" cy="${cy}" r="${R}" fill="none" stroke="rgba(255,255,255,0.06)" stroke-width="13"/>
          ${segs.map(s=>`<circle cx="${cx}" cy="${cy}" r="${R}" fill="none" stroke="${s.col}" stroke-width="13" stroke-dasharray="${s.dash} ${s.gap}" stroke-dashoffset="${circ-s.off}" transform="rotate(-90 ${cx} ${cy})"/>`).join('')}
        </svg>
        <div class="donut-center"><div class="donut-pct" style="color:var(--green)">${posPct}%</div><div class="donut-sub">Positivo</div></div>
      </div>
      <div class="resolution-legend">${cats.map((c,i)=>{const p=total?Math.round(counts[i]/total*100):0;return counts[i]?`<div class="leg-row"><div class="leg-dot" style="background:${cols[i]}"></div><div class="leg-label">${c}</div><div class="leg-val">${p}%</div></div>`:''}).join('')}</div>
    </div>`;
}

// ‚îÄ‚îÄ RECENT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderRecent(data) {
  if (!data.length) { document.getElementById('recentPanel').innerHTML = empty(); return; }
  const recent = [...data].reverse().slice(0,8);
  const chip = r => ['S√≠','Bastante'].includes(r)?`<span class="td-chip chip-green">${r}</span>`:r==='M√°s o menos'?`<span class="td-chip chip-yellow">${r}</span>`:`<span class="td-chip chip-red">${r}</span>`;
  document.getElementById('recentPanel').innerHTML = `<div style="overflow-x:auto"><table class="recent-table"><thead><tr><th>Fecha</th><th>Agente</th><th>Cliente</th><th>Tel√©fono</th><th>Estrellas</th><th>Espera</th><th>Resoluci√≥n</th></tr></thead><tbody>${recent.map(r=>`<tr><td class="td-gray">${fmtDate(r.fecha)}</td><td style="font-weight:600">${(r.agente||'').split(' ')[0]}</td><td class="td-gray">${(r.cliente||'').split(' ')[0]}</td><td class="td-gray">${r.telefono||'‚Äî'}</td><td class="td-stars">${'‚òÖ'.repeat(Number(r.estrellas))}${'‚òÜ'.repeat(5-Number(r.estrellas))}</td><td class="td-gray">${r.espera||'‚Äî'}</td><td>${chip(r.resolucion)}</td></tr>`).join('')}</tbody></table></div>`;
}

function fmtDate(d){ try{ return new Date(d).toLocaleDateString('es-AR',{day:'2-digit',month:'2-digit'}); }catch{return d||'‚Äî'} }
function empty(){ return '<div style="text-align:center;padding:24px;color:var(--gray);font-size:12px">Sin datos para este per√≠odo</div>'; }

// Auto-inicializar si ya est√° autenticado
if (sessionStorage.getItem(SESSION_KEY)) loadData();

// Auto-refresh cada 5 minutos
setInterval(()=>{ if(sessionStorage.getItem(SESSION_KEY)) loadData(); }, 5*60*1000);
</script>
</body>
</html>
